image:
  name: haskell:8.4.4
  entrypoint: [""]

before_script:
  - apt-get update -qq && apt-get install -y -qq hasktags hlint stylish-haskell

stages:
  - all

variables:
  RTSOPTS: "+RTS -N1"
  STACK_ROOT: "${CI_PROJECT_DIR}/.stack"

cache:
  key: wordpuzzle-cache
  paths:
    - .stack
    - .stack-work

build:
  stage: build
  script:
    - make clean setup
    - make check
    - make build
    - make test
    - make doc
    - make bench
  artifacts:
    paths:
      - .stack-work/benchmark.html
      - .stack-work/dist
      - .stack-work/install

pages:
  stage: deploy
  script:
    - mv .stack-work/dist/x86_64-linux-tinfo6/Cabal-2.2.0.1/doc/html/ public
    - mv .stack-work/benchmark.html public/
  artifacts:
    paths:
      - public
      - .stack-work/install/x86_64-linux/lts-12.26/8.4.4/bin/wordpuzzle
  only:
    - master
